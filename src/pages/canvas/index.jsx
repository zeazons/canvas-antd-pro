import React, { useEffect, useRef, forwardRef } from 'react';
import { addRule } from './service';

import FlowPanel from './components/FlowPanel';
import WidgetsPanel from './components/WidgetsPanel';
import ToolbarPanel from './components/ToolbarPanel';
import PropertiesPanel from './components/PropertiesPanel';

const Canvas = forwardRef((props, ref) => {
  const refs = useRef(Array.from({ length: 4 }, (objRef) => React.createRef()));

  return (
    <>
      <button
        onClick={(e) => {
          const dataParams = {
            params: {
              data: { username: 'Ronaldo', canvasId: '250' },
            },
          };
          addRule(dataParams);
        }}
      >
        loadCanvas
      </button>
      <button
        onClick={(e) => {
          onReadFlowClick(refs.current[0]);
        }}
      >
        Read Flow
      </button>

      <FlowPanel ref={(el) => (refs.current[0] = el)} />
      <WidgetsPanel ref={(el) => (refs.current[1] = el)} />
      <ToolbarPanel ref={(el) => (refs.current[2] = el)} />
      <PropertiesPanel ref={(el) => (refs.current[3] = el)} />
    </>
  );
});

export default Canvas;

const onReadFlowClick = (ref) => {
  const xmlFlow =
    '\u003cmxGraphModel\u003e\u003croot\u003e\u003cmxCell id="0"/\u003e\u003cmxCell id="1" parent="0"/\u003e\u003cmxCell id="49" nodeId="START_1" nodeType="STARTFLOW" parent="1" style="fillColor=#cccccc;gradientColor=#c0c0c0;fontColor=#000000;strokeWidth=2;strokeColor=#c0c0c0;shape=ellipse" value="START" vertex="1"\u003e\u003cmxGeometry as="geometry" height="48.0" width="48.0" x="392.0" y="32.0"/\u003e\u003c/mxCell\u003e\u003cmxCell id="50" nodeId="CODE_2" nodeType="CODE" parent="1" style="fillColor=#cccccc;gradientColor=#c0c0c0;fontColor=#000000;strokeWidth=2;strokeColor=#c0c0c0;shape=label;perimeter=rectanglePerimeter;fontStyle=0;align=center;verticalAlign=middle;spacing=0;spacingLeft=0;imageWidth=32;imageHeight=32;rounded=1;shadow=0;glass=0;imageAlign=left;imageVerticalAlign=top;verticalLabelPosition=middle;spacingTop=6;image=https://zerox.beebuddy.net:4454/cavnas/resource/ssquare/node-icon/iconCode.png" value="{ CODE }" vertex="1"\u003e\u003cmxGeometry as="geometry" height="64.0" width="112.0" x="360.0" y="128.0"/\u003e\u003c/mxCell\u003e\u003cmxCell edge="1" id="51" parent="1" source="49" style="labelBackgroundColor=#ffffff;strokeColor=#111111" target="50" value=""\u003e\u003cmxGeometry as="geometry" relative="1"\u003e\u003cmxPoint as="sourcePoint" x="416.0" y="56.0"/\u003e\u003cmxPoint as="targetPoint" x="416.0" y="128.0"/\u003e\u003c/mxGeometry\u003e\u003c/mxCell\u003e\u003cmxCell id="52" nodeId="DECISION_2" nodeType="DECISION" parent="1" style="shape=rhombus;fillColor=#cccccc;gradientColor=#c0c0c0;fontColor=#000000;strokeWidth=2;strokeColor=#c0c0c0" value="1" vertex="1"\u003e\u003cmxGeometry as="geometry" height="48.0" width="48.0" x="392.0" y="240.0"/\u003e\u003c/mxCell\u003e\u003cmxCell edge="1" id="53" parent="1" source="50" style="labelBackgroundColor=#ffffff;strokeColor=#111111" target="52" value=""\u003e\u003cmxGeometry as="geometry" relative="1"\u003e\u003cmxPoint as="sourcePoint" x="416.0" y="160.0"/\u003e\u003cmxPoint as="targetPoint" x="416.0" y="248.0"/\u003e\u003c/mxGeometry\u003e\u003c/mxCell\u003e\u003cmxCell id="54" nodeId="SCREEN_1" nodeType="SCREEN" parent="1" style="fillColor=#cccccc;gradientColor=#c0c0c0;fontColor=#000000;strokeWidth=2;strokeColor=#c0c0c0;shape=label;perimeter=rectanglePerimeter;fontStyle=0;align=center;verticalAlign=middle;spacing=0;spacingLeft=0;imageWidth=32;imageHeight=32;rounded=1;shadow=0;glass=0;imageAlign=left;imageVerticalAlign=top;verticalLabelPosition=middle;spacingTop=6;image=https://zerox.beebuddy.net:4454/cavnas/resource/ssquare/node-icon/iconScreen.png" value=" [ Adirak_Screen ]" vertex="1"\u003e\u003cmxGeometry as="geometry" height="64.0" width="144.0" x="192.0" y="296.0"/\u003e\u003c/mxCell\u003e\u003cmxCell id="55" nodeId="SCREEN_4" nodeType="SCREEN" parent="1" style="fillColor=#cccccc;gradientColor=#c0c0c0;fontColor=#000000;strokeWidth=2;strokeColor=#c0c0c0;shape=label;perimeter=rectanglePerimeter;fontStyle=0;align=center;verticalAlign=middle;spacing=0;spacingLeft=0;imageWidth=32;imageHeight=32;rounded=1;shadow=0;glass=0;imageAlign=left;imageVerticalAlign=top;verticalLabelPosition=middle;spacingTop=6;image=https://zerox.beebuddy.net:4454/cavnas/resource/ssquare/node-icon/iconScreen.png" value=" [ Adirak_Screen1 ]" vertex="1"\u003e\u003cmxGeometry as="geometry" height="64.0" width="144.0" x="472.0" y="304.0"/\u003e\u003c/mxCell\u003e\u003cmxCell edge="1" id="56" parent="1" source="52" style="labelBackgroundColor=#ffffff;strokeColor=#111111" target="54" value=" Yes "\u003e\u003cmxGeometry as="geometry" relative="1"\u003e\u003cmxPoint as="sourcePoint" x="416.0" y="264.0"/\u003e\u003cmxPoint as="targetPoint" x="296.0" y="304.0"/\u003e\u003c/mxGeometry\u003e\u003c/mxCell\u003e\u003cmxCell edge="1" id="57" parent="1" source="52" style="labelBackgroundColor=#ffffff;strokeColor=#111111" target="55" value=" No "\u003e\u003cmxGeometry as="geometry" relative="1"\u003e\u003cmxPoint as="sourcePoint" x="416.0" y="264.0"/\u003e\u003cmxPoint as="targetPoint" x="496.0" y="320.0"/\u003e\u003c/mxGeometry\u003e\u003c/mxCell\u003e\u003cmxCell id="58" nodeId="KEY_2" nodeType="KEY" parent="1" style="shape=rectangle;rounded=1;fillColor=#cccccc;gradientColor=#c0c0c0;fontColor=#000000;strokeWidth=2;strokeColor=#c0c0c0" value="Enter" vertex="1"\u003e\u003cmxGeometry as="geometry" height="48.0" width="80.0" x="224.0" y="400.0"/\u003e\u003c/mxCell\u003e\u003cmxCell edge="1" id="59" parent="1" source="54" style="labelBackgroundColor=#ffffff;strokeColor=#111111" target="58" value=""\u003e\u003cmxGeometry as="geometry" relative="1"\u003e\u003cmxPoint as="sourcePoint" x="264.0" y="328.0"/\u003e\u003cmxPoint as="targetPoint" x="264.0" y="432.0"/\u003e\u003c/mxGeometry\u003e\u003c/mxCell\u003e\u003cmxCell id="60" nodeId="KEY_4" nodeType="KEY" parent="1" style="shape=rectangle;rounded=1;fillColor=#cccccc;gradientColor=#c0c0c0;fontColor=#000000;strokeWidth=2;strokeColor=#c0c0c0" value="F12" vertex="1"\u003e\u003cmxGeometry as="geometry" height="48.0" width="80.0" x="504.0" y="408.0"/\u003e\u003c/mxCell\u003e\u003cmxCell edge="1" id="61" parent="1" source="55" style="labelBackgroundColor=#ffffff;strokeColor=#111111" target="60" value=""\u003e\u003cmxGeometry as="geometry" relative="1"\u003e\u003cmxPoint as="sourcePoint" x="544.0" y="336.0"/\u003e\u003cmxPoint as="targetPoint" x="552.0" y="432.0"/\u003e\u003c/mxGeometry\u003e\u003c/mxCell\u003e\u003cmxCell id="63" nodeId="MULTIDECISION_3" nodeType="MULTIDECISION" parent="1" style="shape=rhombus;fillColor=#cccccc;gradientColor=#c0c0c0;fontColor=#000000;strokeWidth=2;strokeColor=#c0c0c0" value="3" vertex="1"\u003e\u003cmxGeometry as="geometry" height="64.0" width="64.0" x="384.0" y="496.0"/\u003e\u003c/mxCell\u003e\u003cmxCell edge="1" id="64" parent="1" source="58" style="labelBackgroundColor=#ffffff;strokeColor=#111111" target="63" value=""\u003e\u003cmxGeometry as="geometry" relative="1"\u003e\u003cmxPoint as="sourcePoint" x="264.0" y="424.0"/\u003e\u003cmxPoint as="targetPoint" x="424.0" y="536.0"/\u003e\u003c/mxGeometry\u003e\u003c/mxCell\u003e\u003cmxCell edge="1" id="65" parent="1" source="60" style="labelBackgroundColor=#ffffff;strokeColor=#111111" target="63" value=""\u003e\u003cmxGeometry as="geometry" relative="1"\u003e\u003cmxPoint as="sourcePoint" x="544.0" y="432.0"/\u003e\u003cmxPoint as="targetPoint" x="424.0" y="536.0"/\u003e\u003c/mxGeometry\u003e\u003c/mxCell\u003e\u003cmxCell id="66" nodeId="CODE_4" nodeType="CODE" parent="1" style="fillColor=#cccccc;gradientColor=#c0c0c0;fontColor=#000000;strokeWidth=2;strokeColor=#c0c0c0;shape=label;perimeter=rectanglePerimeter;fontStyle=0;align=center;verticalAlign=middle;spacing=0;spacingLeft=0;imageWidth=32;imageHeight=32;rounded=1;shadow=0;glass=0;imageAlign=left;imageVerticalAlign=top;verticalLabelPosition=middle;spacingTop=6;image=https://zerox.beebuddy.net:4454/cavnas/resource/ssquare/node-icon/iconCode.png" value="{ CODE }" vertex="1"\u003e\u003cmxGeometry as="geometry" height="64.0" width="112.0" x="128.0" y="664.0"/\u003e\u003c/mxCell\u003e\u003cmxCell edge="1" id="67" parent="1" source="63" style="labelBackgroundColor=#ffffff;strokeColor=#111111" target="95" value="Condition 1"\u003e\u003cmxGeometry as="geometry" relative="1"\u003e\u003cmxPoint as="sourcePoint" x="416.0" y="528.0"/\u003e\u003cmxPoint as="targetPoint" x="200.0" y="632.0"/\u003e\u003c/mxGeometry\u003e\u003c/mxCell\u003e\u003cmxCell id="74" nodeId="DB_5" nodeType="DB" parent="1" style="fillColor=#cccccc;gradientColor=#c0c0c0;fontColor=#000000;strokeWidth=2;strokeColor=#c0c0c0;shape=label;perimeter=rectanglePerimeter;fontStyle=0;align=center;verticalAlign=middle;spacing=0;spacingLeft=0;imageWidth=32;imageHeight=32;rounded=1;shadow=0;glass=0;imageAlign=left;imageVerticalAlign=top;verticalLabelPosition=middle;spacingTop=6;image=https://zerox.beebuddy.net:4454/cavnas/resource/ssquare/node-icon/iconDB.png" value="{ DATABASE }" vertex="1"\u003e\u003cmxGeometry as="geometry" height="64.0" width="112.0" x="368.0" y="808.0"/\u003e\u003c/mxCell\u003e\u003cmxCell edge="1" id="75" parent="1" source="66" style="labelBackgroundColor=#ffffff;strokeColor=#111111" target="74" value=""\u003e\u003cmxGeometry as="geometry" relative="1"\u003e\u003cmxPoint as="sourcePoint" x="184.0" y="632.0"/\u003e\u003cmxPoint as="targetPoint" x="384.0" y="840.0"/\u003e\u003c/mxGeometry\u003e\u003c/mxCell\u003e\u003cmxCell id="79" nodeId="END_3" nodeType="ENDFLOW" parent="1" style="fillColor=#cccccc;gradientColor=#c0c0c0;fontColor=#000000;strokeWidth=2;strokeColor=#c0c0c0;shape=ellipse" value="END" vertex="1"\u003e\u003cmxGeometry as="geometry" height="48.0" width="48.0" x="400.0" y="952.0"/\u003e\u003c/mxCell\u003e\u003cmxCell edge="1" id="80" parent="1" source="74" style="labelBackgroundColor=#ffffff;strokeColor=#111111" target="79" value=""\u003e\u003cmxGeometry as="geometry" relative="1"\u003e\u003cmxPoint as="sourcePoint" x="424.0" y="840.0"/\u003e\u003cmxPoint as="targetPoint" x="432.0" y="968.0"/\u003e\u003c/mxGeometry\u003e\u003c/mxCell\u003e\u003cmxCell id="82" nodeId="MENU_3" nodeType="MENU" parent="1" style="fillColor=#cccccc;gradientColor=#c0c0c0;fontColor=#000000;strokeWidth=2;strokeColor=#c0c0c0;shape=label;perimeter=rectanglePerimeter;fontStyle=0;align=center;verticalAlign=middle;spacing=0;spacingLeft=0;imageWidth=32;imageHeight=32;rounded=1;shadow=0;glass=0;imageAlign=left;imageVerticalAlign=top;verticalLabelPosition=middle;spacingTop=6;image=https://zerox.beebuddy.net:4454/cavnas/resource/ssquare/node-icon/iconMenu.png" value="{ MENU }" vertex="1"\u003e\u003cmxGeometry as="geometry" height="64.0" width="112.0" x="728.0" y="608.0"/\u003e\u003c/mxCell\u003e\u003cmxCell edge="1" id="84" parent="1" source="82" style="labelBackgroundColor=#ffffff;strokeColor=#111111" target="74" value=""\u003e\u003cmxGeometry as="geometry" relative="1"\u003e\u003cmxPoint as="sourcePoint" x="728.0" y="640.0"/\u003e\u003cmxPoint as="targetPoint" x="432.0" y="840.0"/\u003e\u003c/mxGeometry\u003e\u003c/mxCell\u003e\u003cmxCell id="85" nodeId="SELECTIONLIST_3" nodeType="SELECTIONLIST" parent="1" style="fillColor=#cccccc;gradientColor=#c0c0c0;fontColor=#000000;strokeWidth=2;strokeColor=#c0c0c0;shape=label;perimeter=rectanglePerimeter;fontStyle=0;align=center;verticalAlign=middle;spacing=0;spacingLeft=0;imageWidth=32;imageHeight=32;rounded=1;shadow=0;glass=0;imageAlign=left;imageVerticalAlign=top;verticalLabelPosition=middle;spacingTop=6;image=https://zerox.beebuddy.net:4454/cavnas/resource/ssquare/node-icon/icon_listSelection.png" value="{ SELECTION }" vertex="1"\u003e\u003cmxGeometry as="geometry" height="64.0" width="128.0" x="472.0" y="632.0"/\u003e\u003c/mxCell\u003e\u003cmxCell edge="1" id="86" parent="1" source="63" style="labelBackgroundColor=#ffffff;strokeColor=#111111" target="85" value="Condition 3"\u003e\u003cmxGeometry as="geometry" relative="1"\u003e\u003cmxPoint as="sourcePoint" x="416.0" y="528.0"/\u003e\u003cmxPoint as="targetPoint" x="528.0" y="688.0"/\u003e\u003c/mxGeometry\u003e\u003c/mxCell\u003e\u003cmxCell edge="1" id="87" parent="1" source="85" style="labelBackgroundColor=#ffffff;strokeColor=#111111" target="74" value=""\u003e\u003cmxGeometry as="geometry" relative="1"\u003e\u003cmxPoint as="sourcePoint" x="520.0" y="664.0"/\u003e\u003cmxPoint as="targetPoint" x="440.0" y="832.0"/\u003e\u003c/mxGeometry\u003e\u003c/mxCell\u003e\u003cmxCell id="88" nodeId="SERVICE_4" nodeType="SERVICE" parent="1" style="fillColor=#cccccc;gradientColor=#c0c0c0;fontColor=#000000;strokeWidth=2;strokeColor=#c0c0c0;shape=label;perimeter=rectanglePerimeter;fontStyle=0;align=center;verticalAlign=middle;spacing=0;spacingLeft=0;imageWidth=32;imageHeight=32;rounded=1;shadow=0;glass=0;imageAlign=left;imageVerticalAlign=top;verticalLabelPosition=middle;spacingTop=6;image=https://zerox.beebuddy.net:4454/cavnas/resource/ssquare/node-icon/iconSubService.png" value="{ SUB SERVICE }" vertex="1"\u003e\u003cmxGeometry as="geometry" height="64.0" width="112.0" x="296.0" y="624.0"/\u003e\u003c/mxCell\u003e\u003cmxCell edge="1" id="89" parent="1" source="63" style="labelBackgroundColor=#ffffff;strokeColor=#111111" target="88" value="Condition 2"\u003e\u003cmxGeometry as="geometry" relative="1"\u003e\u003cmxPoint as="sourcePoint" x="416.0" y="528.0"/\u003e\u003cmxPoint as="targetPoint" x="352.0" y="632.0"/\u003e\u003c/mxGeometry\u003e\u003c/mxCell\u003e\u003cmxCell edge="1" id="90" parent="1" source="88" style="labelBackgroundColor=#ffffff;strokeColor=#111111" target="74" value=""\u003e\u003cmxGeometry as="geometry" relative="1"\u003e\u003cmxPoint as="sourcePoint" x="352.0" y="656.0"/\u003e\u003cmxPoint as="targetPoint" x="408.0" y="824.0"/\u003e\u003c/mxGeometry\u003e\u003c/mxCell\u003e\u003cmxCell id="92" nodeId="MULTISERVICE_3" nodeType="MULTISERVICE" parent="1" style="fillColor=#cccccc;gradientColor=#c0c0c0;fontColor=#000000;strokeWidth=2;strokeColor=#c0c0c0;shape=label;perimeter=rectanglePerimeter;fontStyle=0;align=center;verticalAlign=middle;spacing=0;spacingLeft=0;imageWidth=32;imageHeight=32;rounded=1;shadow=0;glass=0;imageAlign=left;imageVerticalAlign=top;verticalLabelPosition=middle;spacingTop=6;image=https://zerox.beebuddy.net:4454/cavnas/resource/ssquare/node-icon/iconMultiSubService.png" value="{ MSUB SERVICE }" vertex="1"\u003e\u003cmxGeometry as="geometry" height="64.0" width="128.0" x="88.0" y="840.0"/\u003e\u003c/mxCell\u003e\u003cmxCell edge="1" id="93" parent="1" source="88" style="labelBackgroundColor=#ffffff;strokeColor=#111111" target="92" value=" Exception "\u003e\u003cmxGeometry as="geometry" relative="1"\u003e\u003cmxPoint as="sourcePoint" x="352.0" y="656.0"/\u003e\u003cmxPoint as="targetPoint" x="208.0" y="832.0"/\u003e\u003c/mxGeometry\u003e\u003c/mxCell\u003e\u003cmxCell edge="1" id="94" parent="1" source="92" style="labelBackgroundColor=#ffffff;strokeColor=#111111" target="79" value=""\u003e\u003cmxGeometry as="geometry" relative="1"\u003e\u003cmxPoint as="sourcePoint" x="176.0" y="824.0"/\u003e\u003cmxPoint as="targetPoint" x="424.0" y="984.0"/\u003e\u003c/mxGeometry\u003e\u003c/mxCell\u003e\u003cmxCell id="95" nodeId="WS_8" nodeType="WS" parent="1" style="fillColor=#cccccc;gradientColor=#c0c0c0;fontColor=#000000;strokeWidth=2;strokeColor=#c0c0c0;shape=label;perimeter=rectanglePerimeter;fontStyle=0;align=center;verticalAlign=middle;spacing=0;spacingLeft=0;imageWidth=32;imageHeight=32;rounded=1;shadow=0;glass=0;imageAlign=left;imageVerticalAlign=top;verticalLabelPosition=middle;spacingTop=6;image=https://zerox.beebuddy.net:4454/cavnas/resource/ssquare/node-icon/iconWebService.png" value="{ WEB SERVICE }" vertex="1"\u003e\u003cmxGeometry as="geometry" height="64.0" width="112.0" x="40.0" y="496.0"/\u003e\u003c/mxCell\u003e\u003cmxCell edge="1" id="99" parent="1" source="95" style="labelBackgroundColor=#ffffff;strokeColor=#111111" target="66" value=""\u003e\u003cmxGeometry as="geometry" relative="1"\u003e\u003cmxPoint as="sourcePoint" x="96.0" y="528.0"/\u003e\u003cmxPoint as="targetPoint" x="160.0" y="616.0"/\u003e\u003c/mxGeometry\u003e\u003c/mxCell\u003e\u003cmxCell edge="1" id="102" parent="1" source="63" style="labelBackgroundColor=#ffffff;strokeColor=#111111" target="82" value=" Else "\u003e\u003cmxGeometry as="geometry" relative="1"/\u003e\u003c/mxCell\u003e\u003c/root\u003e\u003c/mxGraphModel\u003e';

  ref.readFlow(xmlFlow);
};
